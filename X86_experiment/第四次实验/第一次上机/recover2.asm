.386
DATA	SEGMENT USE16
REMIND	DB'Already recover!$'
DATA	ENDS
STACK	SEGMENT USE16 STACK
		DB 200 DUP(0)
STACK	ENDS
CODE	SEGMENT USE16
		ASSUME DS:DATA,CS:CODE,SS:STACK
START:	XOR AX,AX
		MOV DS,AX
		MOV BX,DS:[16H*4];偏移地址
		MOV	ES,DS:[16H*4+2];段地址
		MOV AX,ES
		
		CMP AX,0F000H;原中断段地址
		JNE RECOVER
		CMP BX,11E0H;原中断偏移地址
		JNE RECOVER
		
		MOV AX,DATA
		MOV DS,AX
		LEA	DX,REMIND
		MOV	AH,9
		INT 21H
		JMP QUIT
		
RECOVER:CLI
		MOV AX,ES:[BX-4];偏移地址
		MOV DS:[16H*4],AX
		MOV	AX,ES:[BX-2];段地址
		MOV	DS:[16H*4+2],AX
		STI
		
QUIT:	MOV AH,4CH
		INT 21H
CODE	ENDS
		END START
		