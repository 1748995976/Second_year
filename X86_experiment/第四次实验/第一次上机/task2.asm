.386
CODE	SEGMENT USE16
		ASSUME CS:CODE,SS:STACK
;新的INT 16H用到的变量
REMIND 	DB'Already change!$'
OLD_INT DW ?,?
;新中断处理程序（INT 16H）的代码
NEW16H:	CMP AH,00H
		JE VER
		CMP AH,10H
		JE VER
		JMP DWORD PTR OLD_INT

VER:	PUSHF
		CALL DWORD PTR OLD_INT
		CMP AL,041H
		JAE IS1
		JMP QUIT
		
IS1:	CMP AL,05AH
		JBE IS
		JMP QUIT
		
IS:		ADD AL,20H

QUIT:	IRET
;初始化（安装新中断向量并常驻内存）程序
START:	PUSH CS
		POP DS
		MOV AX,3516H
		INT 21H
		MOV AX,ES
		
		CMP AX,0F000H;原中断段地址
		JNE HAD
		CMP BX,11E0H;原中断偏移地址
		JNE	HAD
		
NO:		MOV OLD_INT,BX
		MOV OLD_INT+2,ES
		
		;这里是不是自动进行开、关中断？
		MOV DX,OFFSET NEW16H
		MOV AX,2516H
		INT 21H
		
		MOV DX,OFFSET START+15
		
		MOV CL,4
		SHR DX,CL
		ADD DX,10H
		
		MOV AL,0
		MOV AH,31H
		INT 21H
		
HAD:	LEA DX,REMIND
		MOV AH,9
		INT 21H
		MOV AH,4CH
		INT 21H
		
CODE	ENDS
STACK	SEGMENT STACK USE16
		DB 200 DUP(0)
STACK	ENDS
		END START
		
		
		